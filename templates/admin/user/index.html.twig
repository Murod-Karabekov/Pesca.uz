{% extends 'admin/base.html.twig' %}

{% block title %}Users{% endblock %}

{% block admin_body %}
<div class="mb-8">
    <h1 class="text-2xl md:text-3xl font-display font-bold text-brand-dark">Users</h1>
    <p class="text-brand-medium mt-1">Manage registered users and assign roles</p>
</div>

{# ─── Assign Role Card ─── #}
<div class="card p-6 mb-8 max-w-lg">
    <h3 class="font-display font-semibold text-lg text-brand-dark mb-4">Assign Role by Phone</h3>
    <form method="post" action="{{ path('admin_user_assign_role') }}" class="flex flex-col sm:flex-row gap-3">
        <input type="hidden" name="_token" value="{{ csrf_token('assign_role') }}">
        <input type="tel" name="phone" placeholder="+998 XX XXX XX XX" class="input-field flex-1" required>
        <select name="role" class="input-field sm:w-40">
            <option value="ROLE_USER">User</option>
            <option value="ROLE_ADMIN">Admin</option>
        </select>
        <button type="submit" class="btn-primary whitespace-nowrap">Assign</button>
    </form>
</div>

{# ─── Users Table ─── #}
{% if users|length > 0 %}
<div class="card overflow-hidden">
    <div class="overflow-x-auto">
        <table class="w-full">
            <thead class="bg-beige-50 border-b border-beige-200">
                <tr>
                    <th class="px-6 py-4 text-left text-xs font-semibold text-brand-medium uppercase tracking-wider">Name</th>
                    <th class="px-6 py-4 text-left text-xs font-semibold text-brand-medium uppercase tracking-wider">Phone</th>
                    <th class="px-6 py-4 text-left text-xs font-semibold text-brand-medium uppercase tracking-wider">Roles</th>
                    <th class="px-6 py-4 text-left text-xs font-semibold text-brand-medium uppercase tracking-wider">Registered</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-beige-100">
                {% for user in users %}
                <tr class="hover:bg-beige-50/50 transition-colors">
                    <td class="px-6 py-4">
                        <span class="font-medium text-brand-dark text-sm">{{ user.fullName }}</span>
                    </td>
                    <td class="px-6 py-4 text-sm text-brand-medium">{{ user.phone }}</td>
                    <td class="px-6 py-4">
                        {% for role in user.roles %}
                            {% if role == 'ROLE_ADMIN' %}
                                <span class="badge bg-peach-100 text-peach-700">Admin</span>
                            {% elseif role == 'ROLE_USER' %}
                                <span class="badge bg-beige-200 text-brand-medium">User</span>
                            {% endif %}
                        {% endfor %}
                    </td>
                    <td class="px-6 py-4 text-sm text-brand-medium">{{ user.createdAt|date('M d, Y') }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% else %}
<div class="card p-12 text-center">
    <p class="text-brand-medium">No registered users yet.</p>
</div>
{% endif %}
{% endblock %}
